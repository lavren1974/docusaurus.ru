---
slug: /versioning
---

# Версионирование

С помощью специальных команд версионирования в консоли можно создать новую версию документации на основе последнего содержимого в директории `docs`. Затем это замороженное состояние документации будет сохранено и доступно, даже когда документация в директории `docs` продолжит развиваться.

```mdx-code-block
import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
```

:::caution осторожно

Подумайте об этом, прежде чем приступать к версионированию вашей документации — участникам может стать сложно помогать улучшать ее!

:::

В большинстве случаев вам не понадобятся разные версии, так как это увеличит время сборки и усложнит вашу кодовую базу. Разные версии **лучше всего подходят для сайтов с высокой посещаемостью и быстрыми изменениями документации между версиями**. Если ваша документация редко меняется, не добавляйте к ней разные версии.

Читайте далее, чтобы лучше понять, как работает управление версиями, и посмотреть, соответствует ли оно вашим потребностям.

## Общие сведения {#overview}

Типичный сайт документации с разными версиями выглядит следующим образом:

```bash
website
├── sidebars.json        # боковая панель из текущей версии
├── docs                 # директория с документацией из текущей версии
│   ├── foo
│   │   └── bar.md       # https://mysite.com/docs/next/foo/bar
│   └── hello.md         # https://mysite.com/docs/next/hello
├── versions.json        # file to indicate what versions are available
├── versioned_docs
│   ├── version-1.1.0
│   │   ├── foo
│   │   │   └── bar.md   # https://mysite.com/docs/foo/bar
│   │   └── hello.md
│   └── version-1.0.0
│       ├── foo
│       │   └── bar.md   # https://mysite.com/docs/1.0.0/foo/bar
│       └── hello.md
├── versioned_sidebars
│   ├── version-1.1.0-sidebars.json
│   └── version-1.0.0-sidebars.json
├── docusaurus.config.js
└── package.json
```

Файл `versions.json` представляет собой список имен версий, упорядоченных от самой новой к самой старой.

В приведенной ниже таблице объясняется, как версионируемый файл сопоставляется со своей версией и сгенерированным URL-адресом.

| Путь                                    | Версия         | URL-адрес         |
| --------------------------------------- | -------------- | ----------------- |
| `versioned_docs/version-1.0.0/hello.md` | 1.0.0          | /docs/1.0.0/hello |
| `versioned_docs/version-1.1.0/hello.md` | 1.1.0 (latest) | /docs/hello       |
| `docs/hello.md`                         | current        | /docs/next/hello  |

:::tip совет

Файлы в директории `docs` относятся к `current` (текущей) версии документации.

По умолчанию `current` версия помечается как `Next` и размещается в папке `/docs/next/*`, но ее можно полностью настроить в соответствии с потребностями релизного цикла вашего проекта.

:::

### Терминология {#terminology}

Обратите внимание на терминологию, которую мы здесь используем.

<dl>
<dt><b>Current version (текущая версия)</b></dt>
<dd>Версия лежит в папке <code>./docs</code>.</dd>
<dt><b>Latest version / last version (последняя версия)</b></dt>
<dd>Версия, используемая по умолчанию для элементов панели навигации. Обычно имеет путь <code>/docs</code>.</dd>
</dl>

Текущая версия определяется **расположением файловой системы**, а последняя версия определяется **поведением навигации**. Они могут быть, а могут и не быть одной и той же версии! (И конфигурация по умолчанию, как показано в таблице выше, будет рассматривать их как разные: текущая версия в `/docs/next` и последняя в `/docs`.)

## Учебные руководства {#tutorials}

### Добавление тегов новым версиям {#tagging-a-new-version}

1. Во-первых, убедитесь, что текущая версия документации (каталог `./docs`) готова к заморозке.
2. Введите номер новой версии.

```bash npm2yarn
npm run docusaurus docs:version 1.1.0
```

При создании новой версии механизм управления версиями документации делает следующее:

- Копирует полное содержимое папки `docs/` в новую папку `versioned_docs/version-[versionName]/`.
- Создает файл версионированных боковых панелей на основе вашей текущей конфигурации [боковой панели](docs-introduction.md#sidebar) (если она существует) и сохраняет ее как `versioned_sidebars/version-[versionName]-sidebars. json`.
- Добавляет новый номер версии в `versions.json`.

### Создание новых страниц {#creating-new-docs}

1. Добавьте новый файл в папку с соответствующей версией.
2. Включите ссылку на новый файл в соответствующий файл боковой панели в соответствии с номером версии.

```mdx-code-block
<Tabs>
<TabItem value="Структура текущей версии">
```

```bash
# Ваш новый файл.
docs/new.md

# Отредактируйте соответствующий файл боковой панели.
sidebars.js
```

```mdx-code-block
</TabItem>
<TabItem value="Структура старой версии">
```

```bash
# Ваш новый файл.
versioned_docs/version-1.0.0/new.md

# Отредактируйте соответствующий файл боковой панели.
versioned_sidebars/version-1.0.0-sidebars.json
```

```mdx-code-block
</TabItem>
</Tabs>
```

### Обновление существующей версии {#updating-an-existing-version}

Вы можете обновлять несколько версий документации одновременно, поскольку каждая директория в `versioned_docs/` представляет определенные роуты при публикации.

1. Отредактируйте любой файл.
2. Сохраните и отправьте изменения.
3. Файл будет опубликован в версии.

Пример. Если вы измените любой файл в `versioned_docs/version-2.6/`, это повлияет только на документацию под версией `2.6`.

### Удаление существующей версии {#deleting-an-existing-version}

У вас всегда будет возможность удалить любую версию документации.

1. Удалите версию из `versions.json`.

Пример:

```diff
[
  "2.0.0",
  "1.9.0",
  // highlight-next-line
- "1.8.0"
]
```

2. Удалите папку с соответствующей версией. Пример: `versioned_docs/version-1.8.0`.
3. Удалите файл боковой панели с соответствующей версией. Пример: `versioned_sidebars/version-1.8.0-sidebars.json`.

## Настройка модели версионирования {#configuring-versioning-behavior}

«current» («текущая») версия — это имя версии для папки `./docs`. Существуют разные способы управления версиями, но есть два наиболее распространенных подхода:

- Вы выпускаете версию 1 и сразу же начинаете работать над версией 2 (включая работу над документацией). В этом случае **текущая версия (current)** — это v2, которая находится в исходной папке `./docs` и доступна по адресу `example.com/docs/next`. **последняя версия (latest)** — это v1, которая находится в исходной папке `./versioned_docs/version-1` и используется большинством ваших пользователей по адресу `example.com/docs`.
- Вы выпускаете версию 1 и некоторое время будете ее поддерживать, прежде чем задумаетесь о версии 2. В этом случае и **текущая версия (current)**, и **последняя версия (latest)** будут указывать на v1, поскольку документации v2 еще даже не существует!

Настройки Docusaurus по умолчанию отлично подходят для первого варианта использования. Мы пометим текущую версию как «next», и вы даже можете не публиковать ее.

**Для второго варианта использования**: если вы выпускаете v1 и не планируете работать над v2 в ближайшее время, то вместо создания версий v1 и хранения документации в 2 папках ( `./docs` + `./versioned_docs/version-1.0.0`), вы можете «притвориться», что текущая версия является урезанной версией, указав для нее путь и лейбл:

```js title="docusaurus.config.js"
module.exports = {
  presets: [
    '@docusaurus/preset-classic',
    docs: {
      // highlight-start
      lastVersion: 'current',
      versions: {
        current: {
          label: '1.0.0',
          path: '1.0.0',
        },
      },
      // highlight-end
    },
  ],
};
```

Документация в `./docs` будет отображаться, как `/docs/1.0.0` вместо `/docs/next`, и `1.0. 0` станет версией по умолчанию, на которую мы ссылаемся в раскрывающемся списке панели навигации, и вам нужно будет поддерживать только одну папку `./docs`.

Мы предлагаем следующие параметры плагина для настройки модели версионирования:

- `disableVersioning`: Явно отключает версионирование, даже при наличии версий. Сайт будет отображать только текущую версию.
- `includeCurrentVersion`: включает текущую версию (папку `./docs`) вашей документации.
  - **Совет**: отключите этот параметр, если текущая версия находится в стадии разработки и не готова к публикации.
- `lastVersion`: устанавливает, к какой версии относится «последняя версия (latest)» (по адресу `/docs`).
  - **Совет**: указывать `lastVersion: 'current'` имеет смысл, если ваша текущая версия относится к основной версии, которая постоянно обновляется и выпускается. Фактический адрес папки и лейбл последней версии настраиваются.
- `onlyIncludeVersions`: определяет подмножество версий из `versions.json` для деплоя.
  - **Совет**: ограничьтесь 2-мя или 3-мя версиями в разработке и деплойте предварительные версии, чтобы сократить время запуска и сборки.
- `versions`: настройки для каждой версии. Для каждой версии вы можете настроить следующие поля:
  - `label`: название, отображаемое в выпадающем списке версий и баннере.
  - `path`: адрес каждой версии. По умолчанию, последняя версия (latest) доступна по адресу `/` а текущая (current) находится по адресу `/next`.
  - `banner`: принимает значения `'none'`, `'unreleased'`, и `'unmaintained'`. Определяет, что отображается в верхней части каждой страницы документации. Любая версия выше последней будет «не выпущенной (unreleased)», а любая версия ниже будет «неподдерживаемой (unmaintained)».
  - `badge`: показывать ли значок с названием версии в верхней части всех страниц этой версии.
  - `className`: добавляет пользовательский `className` в тег `<html>` у всех страниц этой версии.

Дополнительные сведения см. в разделе [настройка плагина документации](../../api/plugins/plugin-content-docs.md#configuration).

## Элементы панели навигации {#navbar-items}

Мы предлагаем несколько элементов панели навигации, которые помогут вам быстро настроить навигацию по сайту, не беспокоясь об адресах версий.

- [`doc`](../../api/themes/theme-configuration.md#navbar-doc-link): ссылка на страницу документации.
- [`docSidebar`](../../api/themes/theme-configuration.md#navbar-doc-sidebar): ссылка на первый элемент боковой панели.
- [`docsVersion`](../../api/themes/theme-configuration.md#navbar-docs-version): ссылка на главную страницу документации текущей просматриваемой версии.
- [`docsVersionDropdown`](../../api/themes/theme-configuration.md#navbar-docs-version-dropdown): выпадающий список содержащий все доступные версии.

Все эти ссылки будут искать подходящую версию, на которую будут ссылаться, в следующем порядке:

1. **Активная версия**: версия, которую в данный момент просматривает пользователь, если он находится на странице, предоставляемой плагином документации. Если пользователь не на странице документации, возврат к...
2. **Предпочитаемая версия**: версия, которую пользователь просматривал в последний раз. Если истории нет, возврат к...
3. **Последняя версия**: версия по умолчанию, к которой мы переходим, настроенная параметром `lastVersion`.

## Рекомендации {#recommended-practices}

### Версионируйте свою документацию только тогда, когда это необходимо {#version-your-documentation-only-when-needed}

Например, вы создаете документацию для своего npm пакета `foo` и в прямо сейчас используете версию 1.0.0. Затем вы выпускаете патч-версию для исправления незначительной ошибки, и теперь это 1.0.1.

Стоит ли выделить новую версию документации 1.0.1? **Возможно, не стоит**. Документации 1.0.1 и 1.0.0 не должны отличаться в соответствии с semver, потому что в них нет новых функций! Выделение новой версии только лишь создаст ненужные дублированные файлы.

### Держите количество версий небольшим {#keep-the-number-of-versions-small}

Как правило, старайтесь, чтобы количество ваших версий не превышало 10. У вас **весьма вероятно** будет много устаревших версий, которые никто никогда даже не прочтет больше. Например, [Jest](https://jestjs.io/versions) в настоящее время имеет версию `27.4` и поддерживает только несколько последних версий документации, самая младшая из которых — `25.Х`. Держите мало версий 😊

:::tip совет архивируйте старые версии

Если вы развернете свой сайт у Jamstack-поставщика (например, [Netlify](../../deployment.mdx)), поставщик сохранит каждую продакшен сборку в виде снепшота с неизменяемым URL-адресом. Вы можете включить заархивированные версии, которые никогда не будут восстановлены, в качестве внешних ссылок на эти неизменяемые URL-адреса. Сайт Jest и сайт Docusaurus используют такой же паттерн, чтобы количество активных версий было низким.

:::

### Используйте абсолютные импорты в документации {#use-absolute-import-within-the-docs}

Не используйте относительные пути в импортах в документации. Потому что, когда мы выделяем версию, пути перестают работать (в том числе, уровень вложенности другой). Вы можете использовать алиас `@site`, предоставленный Docusaurus, который указывает на директорию `website`. Пример:

```diff
- import Foo from '../src/components/Foo';
+ import Foo from '@site/src/components/Foo';
```

### Ссылайтесь на страницы по относительным путям {#link-docs-by-file-paths}

Ссылайтесь на другие страницы документации используя относительные пути к файлам с расширением `.md`, чтобы Docusaurus смог заменить их на правильные URL-адреса во время сборки. Файлы будут привязаны к соответствующей версии.

```md
The [@hello](hello.md#paginate) document is great!

See the [Tutorial](../getting-started/tutorial.md) for more info.
```

### Глобальные или версионированные ассеты {#global-or-versioned-collocated-assets}

Вам нужно будет решить, будут ли ассеты, такие как изображения и файлы, использоваться для каждой версии отдельно или будут общие для всех версий.

Если ваши ассеты должны быть разделены между версиями, поместите их в версию документации и используйте относительные пути:

```md
![img alt](./myImage.png)

[Скачать этот файл](./file.pdf)
```

Если ваши ассеты глобальные, поместите их в `/static` и используйте абсолютные пути:

```md
![img alt](/myImage.png)

[Скачать этот файл](/file.pdf)
```
